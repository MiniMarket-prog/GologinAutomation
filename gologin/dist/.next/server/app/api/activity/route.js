"use strict";(()=>{var e={};e.id=2504,e.ids=[2504],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},65260:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>_,patchFetch:()=>f,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>g});var i={};o.r(i),o.d(i,{GET:()=>d});var r=o(49303),s=o(88716),a=o(60670),n=o(19692),l=o(99064),c=o(87070);async function d(e){try{let t=await (0,n.t)(),o=(0,l.S)(),{searchParams:i}=new URL(e.url),r=Number.parseInt(i.get("page")||"1"),s=Number.parseInt(i.get("limit")||"50"),a=i.get("dateFrom"),d=i.get("dateTo"),u=i.get("profileId"),p=i.get("action"),g=i.get("success"),m=i.get("folder"),_=(r-1)*s;console.log("[v0] ========================================"),console.log("[v0] Activity API called with filters:",{page:r,limit:s,dateFrom:a,dateTo:d,profileId:u,action:p,success:g,folder:m});let{data:{user:f}}=await t.auth.getUser();console.log("[v0] Authenticated user:",{id:f?.id,email:f?.email});let{data:h}=await o.from("user_folder_assignments").select("folder_name").eq("user_id",f?.id||"");console.log("[v0] User's assigned folders:",{count:h?.length||0,folders:h?.map(e=>e.folder_name)||[]});let v=h?.map(e=>e.folder_name)||[],x=[];if(v.length>0){let{data:e}=await o.from("gologin_profiles").select("id, profile_name, folder_name, assigned_user_id").in("folder_name",v);x=e||[]}console.log("[v0] Profiles accessible via folder assignments:",{count:x.length,sampleProfiles:x.slice(0,5).map(e=>({id:e.id,name:e.profile_name,folder:e.folder_name,assigned_user_id:e.assigned_user_id}))});let{data:y}=await o.from("gologin_profiles").select("id, profile_name, folder_name, assigned_user_id").eq("assigned_user_id",f?.id||"");console.log("[v0] Profiles accessible via assigned_user_id:",{count:y?.length||0,sampleProfiles:y?.slice(0,5).map(e=>({id:e.id,name:e.profile_name,folder:e.folder_name}))||[]});let{count:I}=await o.from("activity_logs").select("*",{count:"exact",head:!0});if(console.log("[v0] Total activity logs in database:",I),x.length>0){let e=x.map(e=>e.id),{count:t}=await o.from("activity_logs").select("*",{count:"exact",head:!0}).in("profile_id",e);console.log("[v0] Activity logs for profiles in user's folders (should see these):",t)}let q=t.from("activity_logs").select(`
        *,
        gologin_profiles(profile_name, folder_name, assigned_user_id),
        automation_tasks(created_by)
      `,{count:"exact"}).order("created_at",{ascending:!1});a&&(q=q.gte("created_at",a)),d&&(q=q.lte("created_at",d)),u&&(q=q.eq("profile_id",u)),p&&(q=q.eq("action",p)),null!=g&&""!==g&&(q=q.eq("success","true"===g)),m&&(q=q.eq("gologin_profiles.folder_name",m));let{data:A,error:E,count:S}=await q.range(_,_+s-1);if(console.log("[v0] Activity query result (with RLS applied):",{count:S,dataLength:A?.length||0,error:E?.message||null}),A&&A.length>0&&console.log("[v0] Sample activity logs returned:",A.slice(0,3).map(e=>({id:e.id,profile_id:e.profile_id,action:e.action,profile_folder:e.gologin_profiles?.folder_name,profile_assigned_user:e.gologin_profiles?.assigned_user_id,created_at:e.created_at}))),console.log("[v0] ========================================"),E)throw E;return c.NextResponse.json({data:A,pagination:{page:r,limit:s,total:S||0,totalPages:Math.ceil((S||0)/s)}})}catch(e){return console.error("[v0] Error fetching activity:",e),c.NextResponse.json({error:e.message},{status:500})}}let u=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/activity/route",pathname:"/api/activity",filename:"route",bundlePath:"app/api/activity/route"},resolvedPagePath:"C:\\Users\\HP\\Documents\\GitHub\\GologinAutomation\\gologin\\app\\api\\activity\\route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:p,staticGenerationAsyncStorage:g,serverHooks:m}=u,_="/api/activity/route";function f(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:g})}},99064:(e,t,o)=>{o.d(t,{S:()=>s});var i=o(61657);let r=null;function s(){if(r)return r;if(!process.env.SUPABASE_SERVICE_ROLE_KEY)throw Error("SUPABASE_SERVICE_ROLE_KEY is not set");return r=(0,i.eI)("https://umhdnhckxgqywxgpybgo.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}},19692:(e,t,o)=>{o.d(t,{t:()=>s});var i=o(67721),r=o(71615);async function s(){let e=await (0,r.cookies)();return(0,i.createServerClient)("https://umhdnhckxgqywxgpybgo.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVtaGRuaGNreGdxeXd4Z3B5YmdvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0MDA1NzYsImV4cCI6MjA3NDk3NjU3Nn0.sodO3ZUaTWDxBBZitsrc_j3SUmVWBNlAsQoDAdzs8mI",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:o,options:i})=>e.set(t,o,i))}catch{}}}})}}};var t=require("../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),i=t.X(0,[8948,4526,9702,5972],()=>o(65260));module.exports=i})();