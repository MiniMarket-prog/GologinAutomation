"use strict";(()=>{var e={};e.id=4471,e.ids=[4471],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},59926:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>g,patchFetch:()=>m,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>f,staticGenerationAsyncStorage:()=>d});var r={};s.r(r),s.d(r,{GET:()=>u});var a=s(49303),o=s(88716),i=s(60670),c=s(99064),n=s(87070);async function u(e){try{let t=(0,c.S)(),{searchParams:s}=new URL(e.url),r=s.get("dateFrom")||new Date(Date.now()-6048e5).toISOString(),a=s.get("dateTo")||new Date().toISOString(),{data:o}=await t.from("activity_logs").select(`
        *,
        gologin_profiles(profile_name, folder_name, assigned_user_id),
        automation_tasks(created_by)
      `).gte("created_at",r).lte("created_at",a),i=o||[];if(!i||0===i.length)return n.NextResponse.json({taskTypeDistribution:[],successRateByTaskType:[],averageDurationByTaskType:[],activityByHour:[],topProfiles:[],folderActivity:[],errorPatterns:[],dailyActivity:[],summary:{totalActivities:0,successfulActivities:0,failedActivities:0,averageDuration:0}});let u={};i.forEach(e=>{u[e.action]=(u[e.action]||0)+1});let l=Object.entries(u).map(([e,t])=>({name:e,value:t})),p={};i.forEach(e=>{p[e.action]||(p[e.action]={total:0,success:0}),p[e.action].total++,e.success&&p[e.action].success++});let d=Object.entries(p).map(([e,t])=>({name:e,rate:Math.round(t.success/t.total*100),total:t.total})),f={};i.forEach(e=>{e.duration_ms&&(f[e.action]||(f[e.action]={total:0,count:0}),f[e.action].total+=e.duration_ms,f[e.action].count++)});let g=Object.entries(f).map(([e,t])=>({name:e,duration:Math.round(t.total/t.count)})),m={};i.forEach(e=>{let t=new Date(e.created_at).getHours();m[t]=(m[t]||0)+1});let h=Array.from({length:24},(e,t)=>({hour:t,count:m[t]||0})),v={};i.forEach(e=>{let t=e.gologin_profiles?.profile_name||"Unknown";v[t]||(v[t]={name:t,count:0,success:0}),v[t].count++,e.success&&v[t].success++});let y=Object.values(v).sort((e,t)=>t.count-e.count).slice(0,10).map(e=>({...e,successRate:Math.round(e.success/e.count*100)})),_={};i.forEach(e=>{let t=e.gologin_profiles?.folder_name||"Uncategorized";_[t]||(_[t]={name:t,count:0,success:0}),_[t].count++,e.success&&_[t].success++});let E=Object.values(_).map(e=>({...e,successRate:Math.round(e.success/e.count*100)})),x={};i.filter(e=>!e.success&&e.details?.error).forEach(e=>{let t=e.details.error||"Unknown error";x[t]=(x[t]||0)+1});let A=Object.entries(x).map(([e,t])=>({error:e,count:t})).sort((e,t)=>t.count-e.count).slice(0,10),S={};i.forEach(e=>{let t=new Date(e.created_at).toISOString().split("T")[0];S[t]||(S[t]={date:t,total:0,success:0,failed:0}),S[t].total++,e.success?S[t].success++:S[t].failed++});let R=Object.values(S).sort((e,t)=>e.date.localeCompare(t.date));return n.NextResponse.json({taskTypeDistribution:l,successRateByTaskType:d,averageDurationByTaskType:g,activityByHour:h,topProfiles:y,folderActivity:E,errorPatterns:A,dailyActivity:R,summary:{totalActivities:i.length,successfulActivities:i.filter(e=>e.success).length,failedActivities:i.filter(e=>!e.success).length,averageDuration:Math.round(i.reduce((e,t)=>e+(t.duration_ms||0),0)/i.filter(e=>e.duration_ms).length)}})}catch(e){return console.error("[v0] Error fetching analytics:",e),n.NextResponse.json({error:e.message},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/activity/analytics/route",pathname:"/api/activity/analytics",filename:"route",bundlePath:"app/api/activity/analytics/route"},resolvedPagePath:"C:\\Users\\HP\\Documents\\GitHub\\GologinAutomation\\gologin\\app\\api\\activity\\analytics\\route.ts",nextConfigOutput:"standalone",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:f}=l,g="/api/activity/analytics/route";function m(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:d})}},99064:(e,t,s)=>{s.d(t,{S:()=>o});var r=s(61657);let a=null;function o(){if(a)return a;if(!process.env.SUPABASE_SERVICE_ROLE_KEY)throw Error("SUPABASE_SERVICE_ROLE_KEY is not set");return a=(0,r.eI)("https://umhdnhckxgqywxgpybgo.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[8948,4526,5972],()=>s(59926));module.exports=r})();