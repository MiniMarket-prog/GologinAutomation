"use strict";(()=>{var e={};e.id=8972,e.ids=[8972],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{e.exports=require("http")},8791:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1568:e=>{e.exports=require("zlib")},2252:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>_,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var o={};r.r(o),r.d(o,{GET:()=>p,POST:()=>d});var s=r(9303),a=r(8716),i=r(670),n=r(9692),l=r(9064),u=r(6569),c=r(7070);async function p(e){try{let t=await (0,u.GJ)();console.log("[v0] Admin status:",t);let r=t?(0,l.S)():await (0,n.t)(),{searchParams:o}=new URL(e.url),s=Number.parseInt(o.get("page")||"1"),a=Number.parseInt(o.get("limit")||"50"),i=o.get("status"),p=o.get("search"),d=o.get("gmailStatus"),g=o.get("folder");if(console.log("[v0] Query params:",{page:s,limit:a,status:i,search:p,gmailStatus:d,folder:g}),g){let{data:e}=await r.from("gologin_profiles").select("folder_name").limit(10),t=Array.from(new Set(e?.map(e=>e.folder_name).filter(Boolean)));console.log("[v0] Sample folder names in DB:",t),console.log("[v0] Looking for folder:",g)}let m=(s-1)*a,f=r.from("gologin_profiles").select("*",{count:"exact"}).order("created_at",{ascending:!1}).range(m,m+a-1);i&&(f=f.eq("status",i)),d&&(f="unchecked"===d?f.is("gmail_status",null):f.eq("gmail_status",d)),g&&(f=f.eq("folder_name",g)),p&&(f=f.or(`profile_name.ilike.%${p}%,gmail_email.ilike.%${p}%,folder_name.ilike.%${p}%`));let{data:h,error:x,count:_}=await f;if(console.log("[v0] Query result:",{count:_,dataLength:h?.length,error:x}),x)throw x;return c.NextResponse.json({profiles:h,total:_,page:s,limit:a,totalPages:Math.ceil((_||0)/a)})}catch(e){return console.error("[v0] Error fetching profiles:",e),c.NextResponse.json({error:e.message},{status:500})}}async function d(e){try{let t=await (0,n.t)(),r=await e.json(),{data:o}=await t.auth.getUser();if(!o.user)return c.NextResponse.json({error:"Unauthorized"},{status:401});let{data:s,error:a}=await t.from("gologin_profiles").insert({profile_id:r.profile_id,profile_name:r.profile_name,gmail_email:r.gmail_email,gmail_password:r.gmail_password,assigned_user_id:r.assigned_user_id||o.user.id}).select().single();if(a)throw a;return c.NextResponse.json(s)}catch(e){return console.error("[v0] Error creating profile:",e),c.NextResponse.json({error:e.message},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/profiles/route",pathname:"/api/profiles",filename:"route",bundlePath:"app/api/profiles/route"},resolvedPagePath:"C:\\Users\\HP\\Documents\\GitHub\\GologinAutomation\\gologin\\app\\api\\profiles\\route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:h}=g,x="/api/profiles/route";function _(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},9064:(e,t,r)=>{r.d(t,{S:()=>a});var o=r(4738);let s=null;function a(){if(s)return s;if(!process.env.SUPABASE_SERVICE_ROLE_KEY)throw Error("SUPABASE_SERVICE_ROLE_KEY is not set");return s=(0,o.eI)("https://umhdnhckxgqywxgpybgo.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}},9692:(e,t,r)=>{r.d(t,{t:()=>a});var o=r(7721),s=r(1615);async function a(){let e=await (0,s.cookies)();return(0,o.createServerClient)("https://umhdnhckxgqywxgpybgo.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVtaGRuaGNreGdxeXd4Z3B5YmdvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0MDA1NzYsImV4cCI6MjA3NDk3NjU3Nn0.sodO3ZUaTWDxBBZitsrc_j3SUmVWBNlAsQoDAdzs8mI",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:o})=>e.set(t,r,o))}catch{}}}})}},6569:(e,t,r)=>{r.d(t,{GJ:()=>a,kF:()=>i});var o=r(9692);async function s(){let e=await (0,o.t)(),{data:{user:t}}=await e.auth.getUser();return t}async function a(){let e=await (0,o.t)(),t=await s();if(!t)return!1;console.log("[v0] Checking admin status for user:",t.email);let{data:r,error:a}=await e.from("users").select("role").eq("email",t.email).single();if(console.log("[v0] User data from database:",r),console.log("[v0] Query error:",a),a||!r)return console.log("[v0] No user data found or error occurred"),!1;let i="admin"===r.role;return console.log("[v0] Is admin:",i),i}async function i(){if(!await a())throw Error("Unauthorized: Admin access required")}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[8948,7462,5972],()=>r(2252));module.exports=o})();