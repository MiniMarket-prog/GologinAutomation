(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[305],{3660:function(e,s,r){Promise.resolve().then(r.bind(r,4821))},4821:function(e,s,r){"use strict";r.d(s,{UserManagementTable:function(){return S}});var a=r(7437),n=r(2265),t=r(2869),l=r(3578),i=r(5974),c=r(4190),o=r(7806),d=r(7782),h=r(4924),u=r(8930),x=r(6110),m=r(5186),j=r(6815),f=r(3647);function p(e){let{open:s,onOpenChange:r,onSuccess:l}=e,[i,c]=(0,n.useState)(!1),[o,d]=(0,n.useState)({email:"",password:"",role:"user"}),h=async e=>{e.preventDefault(),c(!0);try{let e=await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!e.ok){let s=await e.json();throw Error(s.error||"Failed to create user")}l(),r(!1),d({email:"",password:"",role:"user"})}catch(e){console.error("[v0] Error creating user:",e),alert("Failed to create user: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{c(!1)}};return(0,a.jsx)(x.Vq,{open:s,onOpenChange:r,children:(0,a.jsxs)(x.cZ,{children:[(0,a.jsxs)(x.fK,{children:[(0,a.jsx)(x.$N,{children:"Create New User"}),(0,a.jsx)(x.Be,{children:"Add a new user to the system"})]}),(0,a.jsxs)("form",{onSubmit:h,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(j._,{htmlFor:"email",children:"Email"}),(0,a.jsx)(m.I,{id:"email",type:"email",value:o.email,onChange:e=>d({...o,email:e.target.value}),required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(j._,{htmlFor:"password",children:"Password"}),(0,a.jsx)(m.I,{id:"password",type:"password",value:o.password,onChange:e=>d({...o,password:e.target.value}),required:!0,minLength:6})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(j._,{htmlFor:"role",children:"Role"}),(0,a.jsxs)(f.Ph,{value:o.role,onValueChange:e=>d({...o,role:e}),children:[(0,a.jsx)(f.i4,{children:(0,a.jsx)(f.ki,{})}),(0,a.jsxs)(f.Bw,{children:[(0,a.jsx)(f.Ql,{value:"user",children:"User"}),(0,a.jsx)(f.Ql,{value:"admin",children:"Admin"})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(t.z,{type:"button",variant:"outline",onClick:()=>r(!1),children:"Cancel"}),(0,a.jsx)(t.z,{type:"submit",disabled:i,children:i?"Creating...":"Create User"})]})]})]})})}var g=r(1800),w=r(3643),N=r(4508);let y=n.forwardRef((e,s)=>{let{className:r,children:n,...t}=e;return(0,a.jsxs)(w.fC,{ref:s,className:(0,N.cn)("relative overflow-hidden",r),...t,children:[(0,a.jsx)(w.l_,{className:"h-full w-full rounded-[inherit]",children:n}),(0,a.jsx)(v,{}),(0,a.jsx)(w.Ns,{})]})});y.displayName=w.fC.displayName;let v=n.forwardRef((e,s)=>{let{className:r,orientation:n="vertical",...t}=e;return(0,a.jsx)(w.gb,{ref:s,orientation:n,className:(0,N.cn)("flex touch-none select-none transition-colors","vertical"===n?"h-full w-2.5 border-l border-l-transparent p-[1px]":"h-2.5 flex-col border-t border-t-transparent p-[1px]",r),...t,children:(0,a.jsx)(w.q4,{className:"relative flex-1 rounded-full bg-border"})})});function C(e){let{open:s,onOpenChange:r,user:l,onSuccess:i}=e,[c,o]=(0,n.useState)(!1),[d,h]=(0,n.useState)([]),[u,m]=(0,n.useState)([]);(0,n.useEffect)(()=>{s&&(f(),p())},[s,l.id]);let f=async()=>{try{let e=await fetch("/api/folders");if(!e.ok)throw Error("Failed to fetch folders");let s=await e.json();h(s.folders)}catch(e){console.error("[v0] Error fetching folders:",e)}},p=async()=>{try{let e=await fetch("/api/admin/folder-assignments?userId=".concat(l.id));if(!e.ok)throw Error("Failed to fetch assignments");let s=await e.json();m(s.assignments.map(e=>e.folder_name))}catch(e){console.error("[v0] Error fetching assignments:",e)}},w=e=>{m(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])},N=async e=>{e.preventDefault(),o(!0);try{let e=await fetch("/api/admin/folder-assignments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:l.id,folderNames:u})});if(!e.ok){let s=await e.json();throw Error(s.error||"Failed to update folder assignments")}i(),r(!1)}catch(e){console.error("[v0] Error updating folder assignments:",e),alert("Failed to update folder assignments: ".concat(e instanceof Error?e.message:"Unknown error"))}finally{o(!1)}};return(0,a.jsx)(x.Vq,{open:s,onOpenChange:r,children:(0,a.jsxs)(x.cZ,{className:"max-w-md",children:[(0,a.jsxs)(x.fK,{children:[(0,a.jsx)(x.$N,{children:"Manage Folder Access"}),(0,a.jsxs)(x.Be,{children:["Select which folders ",l.email," can access"]})]}),(0,a.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[(0,a.jsx)(y,{className:"h-[300px] rounded-md border p-4",children:(0,a.jsx)("div",{className:"space-y-3",children:d.length>0?d.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(g.X,{id:e,checked:u.includes(e),onCheckedChange:()=>w(e)}),(0,a.jsxs)(j._,{htmlFor:e,className:"cursor-pointer",children:["\uD83D\uDCC1 ",e]})]},e)):(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"No folders found"})})}),(0,a.jsx)("div",{className:"flex justify-between items-center text-sm text-muted-foreground",children:(0,a.jsxs)("span",{children:[u.length," folder(s) selected"]})}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(t.z,{type:"button",variant:"outline",onClick:()=>r(!1),children:"Cancel"}),(0,a.jsx)(t.z,{type:"submit",disabled:c,children:c?"Saving...":"Save Changes"})]})]})]})})}function S(){let[e,s]=(0,n.useState)([]),[r,x]=(0,n.useState)(!0),[m,j]=(0,n.useState)(null),[f,g]=(0,n.useState)(!1),[w,N]=(0,n.useState)(!1),y=async()=>{try{let e=await fetch("/api/admin/users");if(!e.ok)throw Error("Failed to fetch users");let r=await e.json();s(r.users)}catch(e){console.error("[v0] Error fetching users:",e)}finally{x(!1)}};(0,n.useEffect)(()=>{y()},[]);let v=async e=>{if(confirm("Are you sure you want to delete this user?"))try{if(!(await fetch("/api/admin/users/".concat(e),{method:"DELETE"})).ok)throw Error("Failed to delete user");y()}catch(e){console.error("[v0] Error deleting user:",e),alert("Failed to delete user")}},S=e=>{j(e),N(!0)};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Users"}),(0,a.jsxs)(t.z,{onClick:()=>g(!0),children:[(0,a.jsx)(o.Z,{className:"mr-2 h-4 w-4"}),"Create User"]})]}),(0,a.jsx)("div",{className:"rounded-md border",children:(0,a.jsxs)(l.iA,{children:[(0,a.jsx)(l.xD,{children:(0,a.jsxs)(l.SC,{children:[(0,a.jsx)(l.ss,{children:"Email"}),(0,a.jsx)(l.ss,{children:"Role"}),(0,a.jsx)(l.ss,{children:"Created At"}),(0,a.jsx)(l.ss,{className:"w-[80px]",children:"Actions"})]})}),(0,a.jsx)(l.RM,{children:r?(0,a.jsx)(l.SC,{children:(0,a.jsx)(l.pj,{colSpan:4,className:"text-center text-muted-foreground",children:"Loading users..."})}):e.length>0?e.map(e=>(0,a.jsxs)(l.SC,{children:[(0,a.jsx)(l.pj,{className:"font-medium",children:e.email}),(0,a.jsx)(l.pj,{children:(0,a.jsx)(i.C,{variant:"admin"===e.role?"default":"secondary",children:e.role})}),(0,a.jsx)(l.pj,{children:new Date(e.created_at).toLocaleDateString()}),(0,a.jsx)(l.pj,{children:(0,a.jsxs)(c.h_,{children:[(0,a.jsx)(c.$F,{asChild:!0,children:(0,a.jsx)(t.z,{variant:"ghost",size:"icon",children:(0,a.jsx)(d.Z,{className:"h-4 w-4"})})}),(0,a.jsxs)(c.AW,{align:"end",children:[(0,a.jsxs)(c.Xi,{onClick:()=>S(e),children:[(0,a.jsx)(h.Z,{className:"mr-2 h-4 w-4"}),"Manage Folders"]}),(0,a.jsxs)(c.Xi,{onClick:()=>v(e.id),className:"text-red-600",children:[(0,a.jsx)(u.Z,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},e.id)):(0,a.jsx)(l.SC,{children:(0,a.jsx)(l.pj,{colSpan:4,className:"text-center text-muted-foreground",children:"No users found"})})})]})}),(0,a.jsx)(p,{open:f,onOpenChange:g,onSuccess:y}),m&&(0,a.jsx)(C,{open:w,onOpenChange:N,user:m,onSuccess:y})]})}v.displayName=w.gb.displayName}},function(e){e.O(0,[137,481,669,908,839,525,259,971,117,744],function(){return e(e.s=3660)}),_N_E=e.O()}]);