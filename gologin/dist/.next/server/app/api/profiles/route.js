"use strict";(()=>{var e={};e.id=8972,e.ids=[8972],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},68621:e=>{e.exports=require("punycode")},76162:e=>{e.exports=require("stream")},17360:e=>{e.exports=require("url")},71568:e=>{e.exports=require("zlib")},32252:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>x,requestAsyncStorage:()=>m,routeModule:()=>g,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var o={};r.r(o),r.d(o,{GET:()=>p,POST:()=>d});var s=r(49303),a=r(88716),i=r(60670),n=r(19692),l=r(99064),u=r(46569),c=r(87070);async function p(e){try{let t=await (0,u.GJ)();console.log("[v0] Admin status:",t);let r=t?(0,l.S)():await (0,n.t)(),{searchParams:o}=new URL(e.url),s=Number.parseInt(o.get("page")||"1"),a=Number.parseInt(o.get("limit")||"50"),i=o.get("status"),p=o.get("search"),d=o.get("gmailStatus"),g=o.get("folder"),m="true"===o.get("includeDeleted");if(console.log("[v0] Query params:",{page:s,limit:a,status:i,search:p,gmailStatus:d,folder:g,includeDeleted:m}),g){let{data:e}=await r.from("gologin_profiles").select("folder_name").limit(10),t=Array.from(new Set(e?.map(e=>e.folder_name).filter(Boolean)));console.log("[v0] Sample folder names in DB:",t),console.log("[v0] Looking for folder:",g)}let f=(s-1)*a,h=r.from("gologin_profiles").select("*",{count:"exact"}).order("created_at",{ascending:!1}).range(f,f+a-1);m||(h=h.or("is_deleted.is.null,is_deleted.eq.false")),i&&(h=h.eq("status",i)),d&&(h="unchecked"===d?h.is("gmail_status",null):h.eq("gmail_status",d)),g&&(h=h.eq("folder_name",g)),p&&(h=h.or(`profile_name.ilike.%${p}%,gmail_email.ilike.%${p}%,folder_name.ilike.%${p}%`));let{data:_,error:x,count:v}=await h;if(console.log("[v0] Query result:",{count:v,dataLength:_?.length,error:x}),x)throw x;return c.NextResponse.json({profiles:_,total:v,page:s,limit:a,totalPages:Math.ceil((v||0)/a)})}catch(e){return console.error("[v0] Error fetching profiles:",e),c.NextResponse.json({error:e.message},{status:500})}}async function d(e){try{let t=await (0,n.t)(),r=await e.json(),{data:o}=await t.auth.getUser();if(!o.user)return c.NextResponse.json({error:"Unauthorized"},{status:401});let{data:s,error:a}=await t.from("gologin_profiles").insert({profile_id:r.profile_id,profile_name:r.profile_name,gmail_email:r.gmail_email,gmail_password:r.gmail_password,assigned_user_id:r.assigned_user_id||o.user.id}).select().single();if(a)throw a;return c.NextResponse.json(s)}catch(e){return console.error("[v0] Error creating profile:",e),c.NextResponse.json({error:e.message},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/profiles/route",pathname:"/api/profiles",filename:"route",bundlePath:"app/api/profiles/route"},resolvedPagePath:"C:\\Users\\HP\\Documents\\GitHub\\GologinAutomation\\gologin\\app\\api\\profiles\\route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:h}=g,_="/api/profiles/route";function x(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},99064:(e,t,r)=>{r.d(t,{S:()=>a});var o=r(61657);let s=null;function a(){if(s)return s;if(!process.env.SUPABASE_SERVICE_ROLE_KEY)throw Error("SUPABASE_SERVICE_ROLE_KEY is not set");return s=(0,o.eI)("https://umhdnhckxgqywxgpybgo.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}},19692:(e,t,r)=>{r.d(t,{t:()=>a});var o=r(67721),s=r(71615);async function a(){let e=await (0,s.cookies)();return(0,o.createServerClient)("https://umhdnhckxgqywxgpybgo.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVtaGRuaGNreGdxeXd4Z3B5YmdvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0MDA1NzYsImV4cCI6MjA3NDk3NjU3Nn0.sodO3ZUaTWDxBBZitsrc_j3SUmVWBNlAsQoDAdzs8mI",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:o})=>e.set(t,r,o))}catch{}}}})}},46569:(e,t,r)=>{r.d(t,{GJ:()=>a,kF:()=>i});var o=r(19692);async function s(){let e=await (0,o.t)(),{data:{user:t}}=await e.auth.getUser();return t}async function a(){let e=await (0,o.t)(),t=await s();if(!t)return!1;console.log("[v0] Checking admin status for user:",t.email);let{data:r,error:a}=await e.from("users").select("role").eq("email",t.email).single();if(console.log("[v0] User data from database:",r),console.log("[v0] Query error:",a),a||!r)return console.log("[v0] No user data found or error occurred"),!1;let i="admin"===r.role;return console.log("[v0] Is admin:",i),i}async function i(){if(!await a())throw Error("Unauthorized: Admin access required")}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[8948,4526,9702,5972],()=>r(32252));module.exports=o})();